---
title: "Installing with CMake"
description: "Step through installing and integrating GoogleTest and GoogleMock in your project using CMake—the recommended and most common workflow for cross-platform C++ projects. Includes adding as a subdirectory, linking, and verifying the install."
---

# Installing with CMake

Step through installing and integrating GoogleTest and GoogleMock in your project using CMake—the recommended and most common workflow for cross-platform C++ projects. This guide covers adding GoogleTest and GoogleMock as subdirectories, linking against the libraries, and verifying your installation quickly.

---

## 1. Prerequisites & System Requirements

- **CMake Version**: Ensure CMake 3.13 or later is installed (3.14+ recommended for FetchContent workflows).
- **Compiler Support**: A C++17 compatible compiler is required.
- **Network Access**: Needed if downloading GoogleTest at configure time.
- **Optional Tools**: `make`, Visual Studio, or another native builder generated by CMake for build execution.

<Tip>
If you're not sure which CMake version you have, run `cmake --version` in your terminal.
</Tip>

## 2. Installing GoogleTest and GoogleMock Using CMake

You have two main ways to integrate GoogleTest and GoogleMock with CMake:

### A. Standalone Build and Install

This method builds and optionally installs GoogleTest and GoogleMock separately.

<Steps>
<Step title="Clone the Repository">
Clone the GoogleTest repo with a stable tag:

```bash
git clone https://github.com/google/googletest.git -b v1.17.0
cd googletest
```
</Step>
<Step title="Configure the Build">
Create a build directory and generate CMake build files:

```bash
mkdir build
cd build
cmake ..
```

- To build only GoogleTest without GoogleMock, add `-DBUILD_GMOCK=OFF` to the CMake command.
</Step>
<Step title="Build and Install">
Run the build:

```bash
make
```

Then install (requires admin rights):

```bash
sudo make install
```

This installs files to `/usr/local` by default. You can specify a different prefix using `-DCMAKE_INSTALL_PREFIX` on the configuration step.
</Step>
</Steps>

<Warning>
Installing system-wide requires administrative privileges. If you lack these, consider the subdirectory inclusion method.
</Warning>

### B. Incorporate GoogleTest and GoogleMock as Subdirectories

This method is preferred for integrating GoogleTest and GoogleMock directly into your project’s build to ensure consistent compiler and linker settings, especially on Windows.

Add the following to your project's `CMakeLists.txt`:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
# For Windows: Use shared run-time libs to match the parent project.
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_test my_test.cpp)
target_link_libraries(my_test gtest_main)
add_test(NAME my_test COMMAND my_test)
```

This downloads and adds GoogleTest (which includes GoogleMock) at configure time.

<Tip>
You can replace `gtest_main` with `gtest` or `gmock` depending on your needs. Use `gmock_main` if you want GoogleMock with the built-in main() function.
</Tip>

## 3. Linking GoogleTest and GoogleMock

After adding GoogleTest and GoogleMock to your project, you can link your test targets to the required libraries.

- Link with `gtest` or `gtest_main` for GoogleTest only.
- Link with `gmock` or `gmock_main` to include GoogleMock.

Example:

```cmake
add_executable(example_test example_test.cpp)
target_link_libraries(example_test gmock_main)
add_test(NAME example_test COMMAND example_test)
```

<Tip>
`gtest_main` and `gmock_main` provide a main() function so you don’t have to write your own test runner.
</Tip>

## 4. Verifying Your Installation

To verify GoogleTest is correctly installed and linked:

1. Create a simple test file `sample_test.cpp`:

```cpp
#include <gtest/gtest.h>

TEST(SampleTest, AssertionTrue) {
    EXPECT_TRUE(true);
}
```

2. Build your test:

```bash
cmake -S . -B build
cmake --build build
```

3. Run tests with CTest:

```bash
cd build
ctest
```

You should see output confirming the test passed.

<Check>
If tests fail to compile or link, confirm GoogleTest include directories and link libraries are set correctly.
</Check>

## 5. Advanced Configuration and Options

- **`gtest_force_shared_crt` option:** On Windows, if you see runtime library conflicts, set this option to `ON` in your CMake config to force GoogleTest to use the shared runtime libraries.

- **Building Samples and Tests:** GoogleTest and GoogleMock include sample and internal test targets.
  - Enable building these via `-Dgtest_build_samples=ON` and/or `-Dgtest_build_tests=ON`.

- **Custom Compiler Flags:** GoogleTest’s CMake files configure compiler flags for warnings and exception support.

<Tip>
Review `googletest/cmake/internal_utils.cmake` to understand the detailed flags set for various compilers.
</Tip>

## 6. Troubleshooting Common Issues

<AccordionGroup title="Common Installation Problems">
<Accordion title="CMake Can't Find GoogleTest Targets">
If you installed GoogleTest and CMake cannot find it:
- Ensure you run `cmake` with the correct `CMAKE_PREFIX_PATH` to point to your GoogleTest installation.
- Alternatively, use pkg-config integration if available (see the related pkg-config docs).
</Accordion>
<Accordion title="Linker Errors Regarding Runtime Libraries on Windows">
Set `gtest_force_shared_crt=ON` in your `cmake` command or your `CMakeLists.txt` to align runtime linkage between your tests and GoogleTest.
</Accordion>
<Accordion title="Pthread-Related Compilation or Link Errors">
GoogleTest detects pthread availability automatically. If you encounter errors:

- Explicitly set `-DGTEST_HAS_PTHREAD=1` or `0` in your compiler definitions.
- Confirm pthread support is installed on your platform.
- Using GoogleTest’s CMake builds with threading support usually manages this automatically.
</Accordion>
</AccordionGroup>

## 7. Additional Resources and Next Steps

- For comprehensive usage instructions on writing and running tests, explore the [Your First Test: Hello, GoogleTest!](https://example.com/getting-started/configuration-and-first-test/hello-world-test) guide.
- To integrate GoogleMock and write mock-based tests, review [Your First Mock: Basics with GoogleMock](https://example.com/getting-started/configuration-and-first-test/first-mock-example).
- For troubleshooting setup issues, see [Troubleshooting Common Setup Issues](https://example.com/getting-started/troubleshooting-and-validation/common-issues).

<Info>
To use pkg-config integration instead of CMake targets, see the [Using pkg-config with GoogleTest](https://example.com/docs/pkgconfig.md) guide.
</Info>

---

### Summary
This guide presented a clear, step-by-step workflow to integrate GoogleTest and GoogleMock into your C++ projects using CMake. Whether you want a standalone install or prefer embedding GoogleTest via subdirectories, this documentation details the complete process, including build commands, linking examples, verification steps, and troubleshooting advice.

---

For more details, consult the [googletest/README.md](https://github.com/google/googletest/blob/main/README.md) and CMake build scripts within the project for advanced build configuration and flags.


---

# References
- [GoogleTest CMakeLists.txt](https://github.com/google/googletest/blob/main/googletest/CMakeLists.txt)
- [GoogleMock CMakeLists.txt](https://github.com/google/googletest/blob/main/googlemock/CMakeLists.txt)
- [GoogleTest README](https://github.com/google/googletest/blob/main/googletest/README.md)
- [Pkg-config Integration Guide](https://example.com/docs/pkgconfig.md)


# Source Code Links
<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "googletest/CMakeLists.txt", "range": "1-200"},{"path": "googlemock/CMakeLists.txt", "range": "1-170"}]} />
